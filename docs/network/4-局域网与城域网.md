---
order: 96
---

# 第 4 章 局域网与城域网

## 以太网技术

#### 传输介质

单模光纤：>3km

多模光纤：<550m

### 冲突域和广播域

|        | 分割冲突域 | 分割广播域 |
| ------ | :--------: | :--------: |
| 集线器 |     X      |     X      |
| 交换机 |     ✓      |     X      |
| 路由器 |     ✓      |     ✓      |

### 堆叠和级联

级联：可以用一根双绞线在任何设备厂家的交换机之间进行，使用普通端口级联也可以使用uplink端口级联

堆叠：只可以在自己厂家的设备间进行，需要专门的堆叠模块和堆叠线缆，堆叠后的所有交换机可视为一个整体交换机进行管理

## 虚拟局域网vlan(802.1Q)

### vlan注册协议-GVRP协议

#### Normal模式

允许端口动态注册或注销vlan，传播动态vlan及静态vlan信息。

#### Fixed模式

禁止该端口动态注册或者注销vlan，只传播静态vlan，不传播动态vlan信息。

#### Forbidden模式

禁止该端口动态注册或者注销vlan，不传播除VLAN1以外的任何vlan信息。

### 生成树协议-STP

#### 端口状态

1. 转发（Forwarding）

2. 学习（Learning）

3. 侦听（Listening）

4. 阻塞（Blocking），不转发用户数据帧，可以转发**BPDU**数据帧。

5. 禁用（Disabled）

#### 端口优先级判断

网桥优先级缺省值：32768，并且以4096的倍数改变

802.1d-1998标准

|  带宽  | 成本 |
| :----: | :--: |
| 10000M |  2   |
| 1000M  |  4   |
|  100M  |  19  |
|  10M   | 100  |

交换机端口优先级默认为：128，以16倍数增减

交换机阻塞到侦听20s，侦听到学习15s，学习到转发15s，一共50s.

### 快速生成树协议-RSTP（802.1w-802.1D-2004）

端口角色：根端口、指定端口、替代端口、备用端口。

### 多生成树协议-MSTP

根据vlan划分成多个生成树

### 接口类型

**PVID（Port VLAN ID）**：表示接口能够将从外部接收的数据发向哪个VLAN，是接口的属性，当一个普通帧（untagged帧）进入交换机接口时，会被该接口打上VLAN标签，成为tagged帧，并且将接口的PVID值，作为VLAN标签中的VID值(例如10）。

**VID（VLAN ID）**：表示接口能够从交换机内部接收哪些VLAN的数据，也是接口属性。交换机收到一个普通帧后，会给他加上VLAN标签（用到PVID属性），交换机内部在转发VLAN帧（tagged帧）时，会根据该帧VLAN标签中的VID值，检查哪些接口的VID属性值与它相同，如果相同则继续比较该帧头中的目的MAC地址与接口的MAC表项是否匹配，如果匹配则转发给这个接口。

**Access接口**：VID属性值只有一个，且只能转发一个VLAN 的帧。

**Trunk接口**：Trunk接口允许多个VLAN的流量通过，即Trunk接口的VID属性值可以是多个。

<img src="https://gitlab.com/loveagri/pic/-/raw/main/2024-04-20/13/59589_image-20240420132525618.png" alt="image-20240420132525618" style="zoom:33%;" />

**Hybrid接口**：以太网接口设置为Trunk类型，其相应功能都可以使用Hybrid功能来代替。但基于*MAC地址、协议、IP子网的VLAN*只对Hybrid端口配置有效。

## 以太网通道--链路聚合、端口聚合、eth-trunk

### 协议

1. PAGP（端口聚合协议）：Cisco私有
2. LACP（链路聚合控制协议）：802.3ad

## IEEE 802.3标准

CSMA/CD特点：多点接入、先听后发、边发边听、冲突停止、随机延迟后重发。

[截断二进制指数退避算法](https://baike.baidu.com/item/%E6%88%AA%E6%96%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%8C%87%E6%95%B0%E9%80%80%E9%81%BF%E7%AE%97%E6%B3%95/16745902?fr=ge_ala)：碰撞的[站点](https://baike.baidu.com/item/站点/7108922?fromModule=lemma_inlink)在停止发送后，不是立即再发送数据，而是退避一个随机的时间，降低重传时发生冲突的概率。

### 以太网中的传输介质

#### 双绞线（Twisted pairs）：交叉线与直连线

同层设备之间互联-交叉线（路由器-路由器）

不同层设备之间互联-直连线（交换机-PC机）

#### 光缆（纤）

光纤通讯是基于**全反射**原理。

##### 单模光纤：1550nm激光光源，100公里，沿光纤轴心传输。

##### 多模光纤：850nm LED光源，短波，1公里以 内，多个角度入射光。

<img src="https://gitlab.com/loveagri/pic/-/raw/main/2024-04-14/16/81716_image-20240414162003989.png" alt="image-20240414162003989" style="zoom: 33%;" />

### TCP/IP协议和以太网结合的两个关键点

#### 协议封装：把高层数据封装成帧

#### 地址转换：主机在发送帧前通过目标IP地址获得目标MAC地址的过程

ARP(address resolution protocol)：主机在发送帧前通过目标IP地址获得目标MAC地址的协议

集线器：所有接口属于同一个冲突域

交换机：每个接口都是一个独立冲突域，所有接口属于一个广播域

## 交换机

### 交换机连接方式

#### 级联

通过uplink口连接，介质为双绞线，实际工作中仍各自工作，是两个独立的交换机，可以不同厂家。

<img src="https://gitlab.com/loveagri/pic/-/raw/main/2024-04-14/17/47626_image-20240414175456383.png" alt="image-20240414175456383" style="zoom: 33%;" />

#### 堆叠

多台具有堆叠功能的交换机，利用特定堆叠线缆，通过交换机上的堆叠接口连起来，是一个整体，一台交换机，一套配置，统一厂家，有堆叠数量限制 。

<img src="https://gitlab.com/loveagri/pic/-/raw/main/2024-04-14/17/5433_image-20240414175833630.png" alt="image-20240414175833630" style="zoom: 33%;" />

<img src="https://gitlab.com/loveagri/pic/-/raw/main/2024-04-14/17/34845_image-20240414175923978.png" alt="image-20240414175923978" style="zoom:25%;" />

### 管理方式

#### 带外管理

#### 带内管理

思科：

`>`一般用户模式

`#` 特权用户模式
